@import java.util.UUID

@import de.htwg.zeta.common.models.entity.User
@import de.htwg.zeta.server.controller.codeEditor.CodeEditorController.ClassMethodType
@import de.htwg.zeta.server.controller.codeEditor.CodeEditorController.MainMethodType
@import de.htwg.zeta.server.controller.codeEditor.CodeEditorController.MethodEntityType
@import de.htwg.zeta.server.controller.codeEditor.CodeEditorController.ReferenceMethodType

@(user: User, metaModelId: UUID, methodName: String, entityType: String, existingCode: String, entityName: String)


<!DOCTYPE html>
<html>
    <head>

        <title>Scala Code Viewer</title>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, shrink-to-fit=no">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes"/>
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

        <script src="@routes.ScalaRoutes.getAssets("codeEditor/ace/ace.js")"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <style>

                #container {
                    position: absolute;
                    top: 0;
                    right: 0;
                    bottom: 0;
                    left: 0;
                    display: flex;
                    background: #2f3129;
                    padding: 10px;
                }

                #sidebar {
                    flex-grow: 0;
                    color: white;
                }

                #sidebar a {
                    color: white;
                    text-decoration: none;
                    padding: 2px;
                    margin-right: 5px;
                }

                .editor {
                    flex-grow: 1;
                }

        </style>

        <script>
                $(document).ready(() => {
                    const editor = ace.edit("editor");
                    editor.setTheme("ace/theme/monokai");
                    editor.getSession().setMode("ace/mode/scala");
                    //editor.setShowPrintMargin(false);

                    editor.on('input', function () {

                        $.ajax({
                            type: "PUT",
                            url: "@{entityType match {
                                case "class" => routes.ScalaRoutes.putMetaModelsClassMethod(metaModelId, entityName, methodName)
                                case "reference" => routes.ScalaRoutes.putMetaModelsReferenceMethod(metaModelId, entityName, methodName)
                                case "main" => routes.ScalaRoutes.putMetaModelsMainMethod(metaModelId, methodName)
                            }}",
                            contentType: "text/plain",
                            data: editor.getValue(),
                            success: function (data, textStatus, jqXHR) {
                                console.log("method successfully saved");
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                console.log("failed to save method");
                            }

                        });

                    });
                });



        </script>

    </head>
    <body>

        @views.html.webpage.WebpageGeneralLayout("CodeEditor", Some(user)) {

            <div id="container">
                <div id="editor" class="editor">@existingCode</div>
            </div>
        }

    </body>
</html>
